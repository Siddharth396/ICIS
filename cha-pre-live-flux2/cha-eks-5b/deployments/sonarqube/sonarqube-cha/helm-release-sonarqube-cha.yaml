apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: sonarqube
spec:
  values:
    image:
      repository: "artifacts.cha.rbxd.ds/automated/sonarqube/sonarqube-server" # {"$imagepolicy": "flux-system:sonarqube-cha:name"} 
      tag: "cha-15-9.9.1-community" # {"$imagepolicy": "flux-system:sonarqube-cha:tag"} 
      pullPolicy: IfNotPresent
    namespace: "sonarqube-cha"
    ingress:
      enabled: true
      ingressClassName: icis-nginx-ingress
      hosts:
        - name: sonarqube.cha.eu-west-1.dev
          path: /
      annotations:
        external-dns.alpha.kubernetes.io/hostname: sonarqube.cha.eu-west-1.dev
      tls:
        - hosts:
            - sonarqube.cha.eu-west-1.dev
          secretName: sonarqube.cha.eu-west-1.dev
    jdbcOverwrite:
      enable: true
      jdbcUrl: "jdbc:postgresql://icis-sonarqube-cha-db.c5xpmfqwcbio.eu-west-1.rds.amazonaws.com:5432/"
    vault:
      VaultSecretPath: "kv/cha/k8s/data/sonarqube/cha"
    resources:
      limits:
        cpu: 800m
        memory: 4Gi
      requests:
        cpu: 400m
        memory: 2Gi

# test2
