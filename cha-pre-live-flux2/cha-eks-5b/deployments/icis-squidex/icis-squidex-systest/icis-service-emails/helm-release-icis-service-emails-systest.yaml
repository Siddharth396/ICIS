apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: icis-squidex-systest
  namespace: icis-squidex-systest
spec:
  releaseName: icis-service-emails-systest
  upgrade:
    remediation:
      remediateLastFailure: false
      strategy: rollback
  values:
    projectName: "icis-service-emails"
    serviceAccountName: icis-service-emails
    squidex:
      image:
        repository: artifacts.cha.rbxd.ds/automated/icis-squidex # {"$imagepolicy": "flux-system:icis-squidex-systest-icis-service-emails:name"}
        tag: systest-icis-service-emails-1-7.7.31 # {"$imagepolicy": "flux-system:icis-squidex-systest-icis-service-emails:tag"}
      customEnvValues:
        ADMIN__ADMINAPPS__0: icis-service-emails
        ADMIN__ADMINUSERGROUP__0: ICIS_Earth
        CONTENTS__MAXRESULTS: "'6000'"
        CONTENTS__DEFAULTPAGESIZE: "'6000'"
        UI__REFERENCESDROPDOWNITEMCOUNT: "'6000'"
        ASSETSTORE__TYPE: "'AmazonS3'"
        ASSETSTORE__AMAZONS3__BUCKET: "'icis-ns-email-dispatcher-pre-live'"
        ASSETSTORE__AMAZONS3__BUCKETFOLDER: "'systest/attachments'"
        ASSETSTORE__AMAZONS3__REGIONNAME: "'eu-west-1'"
        ASSETSTORE__AMAZONS3__FORCEPATHSTYLE: "'false'"
        ASSETSTORE__AMAZONS3__USEIAM: "'true'"
        ASSETSTORE__EXPOSESOURCEURL: "'true'"
      kafka:
        enabled: True
    squidexCli:
      enabled: True
      schedule: "'40 9,12,15,18 * * *'"
      image:
        repository: artifacts.cha.rbxd.ds/automated/icis-squidex-cli # {"$imagepolicy": "flux-system:icis-squidex-cli-systest:name"}
        tag: systest-9-8.0.13-test-vault-changes.1 # {"$imagepolicy": "flux-system:icis-squidex-cli-systest:tag"}
        pullPolicy: IfNotPresent
    vault_squidex_secrets:
      name: icis-service-emails-squidex-systest-secret
    vault_kafka_secrets:
      name: icis-service-emails-squidex-kafka-systest-secret
      VaultSecretPath: "icis-squidex/icis-service-emails/systest"
