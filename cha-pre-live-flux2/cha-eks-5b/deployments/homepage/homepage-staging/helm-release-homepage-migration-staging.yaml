apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: job
spec:
  values:
    namespace: "homepage-staging"
    job:
      image:
        repository: artifacts.cha.rbxd.ds/automated/homepage/migration # {"$imagepolicy": "flux-system:homepage-migration-staging:name"}
        tag: staging-5-0.0.1-feature-test-tool-5098 # {"$imagepolicy": "flux-system:homepage-migration-staging:tag"}
      config_env:
        ENVIRONMENT: staging
        SECRET_FILE_PATH: /etc/secrets/.env
        # https://www.elastic.co/guide/en/apm/agent/dotnet/current/config-core.html
        ELASTIC_APM_SERVER_URLS: https://apm.genesis.cha.eu-west-1.dev/
        ELASTIC_APM_TRANSACTION_SAMPLE_RATE: .5
        ELASTIC_APM_CAPTURE_BODY: all
        TRACE_ENABLED: true
        DB_URL: https://dbapi.staging.genesis.cha.rbxd.ds/v1
        # SQL
        SQL_HOST: genesis-ups-stag.c5xpmfqwcbio.eu-west-1.rds.amazonaws.com
        SQL_CAT: genesis-ups-staging
        SQL_USR: genesis-ups-staging
        # MongoDb
        PRICING_MONGO_SERVER: cha-pre-live-ak0n6.mongodb.net
        PRICING_MONGO_DB_NAME: pricing-staging
        FAVORITE_PUBLICATIONS_MONGO_SERVER: cha-pre-live-ak0n6.mongodb.net
        FAVORITE_PUBLICATIONS_MONGO_DB_NAME: favorite-publications-staging
        COMMODITY_MONGO_SERVER: cha-pre-live-ak0n6.mongodb.net
        COMMODITY_MONGO_DB_NAME: commodity-staging
        # Patterns
        PRICE_SERIES_PATTERN: "^(petchem|energy)"
        CHART_SERIES_PATTERN: "^(petchem|energy)"
        FAVORITE_PUBLICATIONS_PATTERN: "^(petchem|energy)"
        # Toggles
        MIGRATE_PRICE_SERIES_ENABLED: false
        MIGRATE_COMMODITIES_ENABLED: true
        MIGRATE_CHART_SERIES_ENABLED: false
        ANALYSE_PRICE_SERIES_ENABLED: false
        ANALYSE_COMMODITIES_ENABLED: false
        ANALYSE_CHART_SERIES_ENABLED: false
        USERS_ID_FILE_PATH: "Users-staging.csv"
        PRICE_SERIES_FILE_PATH: "PriceSeriesIdConverter2.csv"
        LOG_LEVEL: Information
        # Connection strings
        PRICING_MONGO_DB_CONNECTION_STRING: "mongodb+srv://<username>:<password>@cha-pre-live-ak0n6.mongodb.net/pricing-staging?retryWrites=true"
        FAVORITE_PUBLICATIONS_MONGO_DB_CONNECTION_STRING: "mongodb+srv://<username>:<password>@cha-pre-live-ak0n6.mongodb.net/favorite-publications-staging?retryWrites=true"
        COMMODITY_MONGO_DB_CONNECTION_STRING: "mongodb+srv://<username>:<password>@cha-pre-live-ak0n6.mongodb.net/c-hub-staging?retryWrites=true"
    vault_secrets:
      name: homepage-migration-vault-secret-staging
      VaultSecretPath: "homepage/staging/bff"
      VaultK8sRoleName: "kv-homepage-read"
      VaultK8sAuthPath: "cha/eks-b"
      VaultSecretMount: "kv/cha/k8s"
