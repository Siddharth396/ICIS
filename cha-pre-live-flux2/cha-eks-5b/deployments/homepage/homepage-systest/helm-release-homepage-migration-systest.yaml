apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: job
spec:
  values:
    namespace: "homepage-systest"
    job:
      image:
        repository: artifacts.cha.rbxd.ds/automated/homepage/migration # {"$imagepolicy": "flux-system:homepage-migration-systest:name"}
        tag: systest-28-0.0.1-feature-test-tool-5098 # {"$imagepolicy": "flux-system:homepage-migration-systest:tag"}
      config_env:
        ENVIRONMENT: systest
        SECRET_FILE_PATH: /etc/secrets/.env
        # https://www.elastic.co/guide/en/apm/agent/dotnet/current/config-core.html
        ELASTIC_APM_SERVER_URLS: https://apm.genesis.cha.eu-west-1.dev/
        ELASTIC_APM_TRANSACTION_SAMPLE_RATE: .5
        ELASTIC_APM_CAPTURE_BODY: all
        TRACE_ENABLED: true
        DB_URL: https://dbapi.systest.genesis.cha.rbxd.ds/v1
        # SQL
        SQL_HOST: genesis-ups-stag.c5xpmfqwcbio.eu-west-1.rds.amazonaws.com
        SQL_CAT: genesis-ups-systest
        SQL_USR: genesis-ups-systest
        # MongoDb
        PRICING_MONGO_SERVER: cha-pre-live-ak0n6.mongodb.net
        PRICING_MONGO_DB_NAME: pricing-systest
        FAVORITE_PUBLICATIONS_MONGO_SERVER: cha-pre-live-ak0n6.mongodb.net
        FAVORITE_PUBLICATIONS_MONGO_DB_NAME: favorite-publications-systest
        COMMODITY_MONGO_SERVER: cha-pre-live-ak0n6.mongodb.net
        COMMODITY_MONGO_DB_NAME: c-hub-systest
        # Connection strings
        PRICING_MONGO_DB_CONNECTION_STRING: "mongodb+srv://<username>:<password>@cha-pre-live-ak0n6.mongodb.net/pricing-systest?retryWrites=true"
        FAVORITE_PUBLICATIONS_MONGO_DB_CONNECTION_STRING: "mongodb+srv://<username>:<password>@cha-pre-live-ak0n6.mongodb.net/favorite-publications-systest?retryWrites=true"
        COMMODITY_MONGO_DB_CONNECTION_STRING: "mongodb+srv://<username>:<password>@cha-pre-live-ak0n6.mongodb.net/c-hub-systest?retryWrites=true"
        # Patterns
        PRICE_SERIES_PATTERN: "^(petchem|energy)"
        CHART_SERIES_PATTERN: "^(petchem|energy)"
        FAVORITE_PUBLICATIONS_PATTERN: "^(petchem|energy)"
        # Toggles
        MIGRATE_PRICE_SERIES_ENABLED: true
        MIGRATE_COMMODITIES_ENABLED: false
        MIGRATE_CHART_SERIES_ENABLED: false
        ANALYSE_PRICE_SERIES_ENABLED: false
        ANALYSE_COMMODITIES_ENABLED: false
        ANALYSE_CHART_SERIES_ENABLED: false
        USERS_ID_FILE_PATH: "Users-systest.csv"
        PRICE_SERIES_FILE_PATH: "PriceSeriesIdConverter2.csv"
        LOG_LEVEL: Information
    vault_secrets:
      name: homepage-migration-vault-secret-systest
      VaultSecretPath: "homepage/systest/bff"
      VaultK8sRoleName: "kv-homepage-read"
      VaultK8sAuthPath: "cha/eks-b"
      VaultSecretMount: "kv/cha/k8s"
