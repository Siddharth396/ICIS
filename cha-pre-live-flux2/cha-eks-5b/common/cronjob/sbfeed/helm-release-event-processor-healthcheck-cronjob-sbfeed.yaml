---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: cronjob
spec:
  values:
    # Commented values have to be overriden in the environment specific helm-release files
    # namespace: "sbfeed-<environment>"
    projectName: "evt-proc-healthcheck-sbfeed"
    ServiceAccountName: "sbfeed"

    cronjob:
    # Commented values have to be overriden in the environment specific helm-release files
      # image:
      #     repository: ""
      #     tag: ""
      # schedule: '"*/10 * * * *"' # every 10 minutes
      concurrencyPolicyAllow: false
      config_env:
        SECRET_FILE_PATH: /etc/secrets/.env
        KAFKA_SCHEMAREGISTRY_URL: https://psrc-4xrp1.eu-central-1.aws.confluent.cloud
        KAFKA_BROKER_URL: pkc-l568n.eu-west-1.aws.confluent.cloud:9092
        Kafka__Broker__SaslMechanism: 1
        Kafka__Broker__SecurityProtocol: 3

        # Commented values have to be overriden in the environment specific helm-release files
        # ENVIRONMENT: <environment>
        # MONGO_DB_CONNECTION_STRING: "mongodb+srv://<username>:<password>@cha-pre-live-ak0n6.mongodb.net/sbfeed-<environment>?retryWrites=true&w=majority"
        # KAFKA_TOPIC_NAME: public_<environment>_alerting_notifications_2

    vault_secrets:
      VaultK8sRoleName: "kv-sbfeed-read"
      VaultK8sAuthPath: "cha/eks-b"
      VaultSecretMount: "kv/cha/k8s"   
      # Commented values have to be overriden in the environment specific helm-release files
      # secretPaths:
      # - basePath: "kv/cha/k8s/data/sbfeed/<environment>/eventprocessor"
      #   secrets:
      #     - key: MONGO_DB_USER
      #       subPath: "mongoUser"
      #     - key: MONGO_DB_PWD
      #       subPath: "mongoPassword"
      #     - key: KAFKA_BROKER_SASL_USERNAME
      #       subPath: "kafkaSaslUsername"
      #     - key: KAFKA_BROKER_SASL_PASSWORD
      #       subPath: "kafkaSaslPassword"
      #     - key: KAFKA_SCHEMA_REGISTRY_BASIC_AUTH_USER_INFO
      #       subPath: "schemaRegistryBasicAuthUserInfo"
