apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: sboutg
  namespace: icis-event-streaming
  labels:
    strimzi.io/cluster: prelive-connect-cluster
spec:
  class: io.confluent.connect.jdbc.JdbcSourceConnector
  tasksMax: 1
  config:
    connector.class: com.mongodb.kafka.connect.MongoSourceConnector
    tasks.max: 1
    value.converter: io.confluent.connect.avro.AvroConverter
    transforms: ValueToKey, ExtractField
    errors.tolerance: none
    errors.log.enable: true
    transforms.ValueToKey.type: org.apache.kafka.connect.transforms.ValueToKey
    transforms.ValueToKey.fields: outageId
    transforms.ExtractField.type: org.apache.kafka.connect.transforms.ExtractField$Key
    transforms.ExtractField.field: outageId
    poll.max.batch.size: 1000
    poll.await.time.ms: 5000
    mongo.errors.log.enable: true
    mongo.errors.tolerance: all
    
    # producer setion
    producer.override.security.protocol: SASL_SSL
    producer.override.sasl.mechanism: PLAIN
    producer.override.sasl.jaas.config: org.apache.kafka.common.security.plain.PlainLoginModule required username='${file:/opt/kafka/external-configuration/kafka-secret-sboutg-publisher/kafka-secret-sboutg:kafka_user}' password='${file:/opt/kafka/external-configuration/kafka-secret-sboutg-publisher/kafka-secret-sboutg:kafka_key}';
    producer.override.bootstrap.servers: pkc-l568n.eu-west-1.aws.confluent.cloud:9092

    # schema registry section
    value.converter.basic.auth.credentials.source: USER_INFO
    key.converter.basic.auth.user.info: ${file:/opt/kafka/external-configuration/schema-registry/schemaRegistry:password}
    key.converter.schemas.enable: false
    value.converter.schema.registry.url: ${file:/opt/kafka/external-configuration/schema-registry/schemaRegistry:url}
    key.converter.basic.auth.credentials.source: USER_INFO
    value.converter.basic.auth.user.info: ${file:/opt/kafka/external-configuration/schema-registry/schemaRegistry:password}
    key.converter.schema.registry.url: ${file:/opt/kafka/external-configuration/schema-registry/schemaRegistry:url}
