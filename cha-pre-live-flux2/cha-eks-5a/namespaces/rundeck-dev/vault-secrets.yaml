---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultAuth
metadata:
  name: rundeck-vault-secret-auth
  namespace: rundeck-dev
spec:
  method: kubernetes
  mount: cha/eks-a
  kubernetes:
    role: kv-rundeck-read
    serviceAccount: rundeck
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: rundeck-database-secret
  namespace: rundeck-dev
spec:
  type: kv-v2

  # mount path
  mount: kv/cha/k8s

  # path of the secret
  path: rundeck/rundeck-database-secret

  # dest k8s secret
  destination:
    name: rundeck-database-secret
    create: true

  # static secret refresh interval
  refreshAfter: 300s

  # Name of the CRD to authenticate to Vault
  vaultAuthRef: rundeck-vault-secret-auth