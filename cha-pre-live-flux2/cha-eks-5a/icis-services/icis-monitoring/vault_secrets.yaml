---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: role-icis-monitoring-tokenreview-binding
subjects:
- kind: ServiceAccount
  name: icis-monitoring
  namespace: icis-monitoring
roleRef:
  kind: ClusterRole
  name: system:auth-delegator
  apiGroup: rbac.authorization.k8s.io

---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultAuth
metadata:
  name: icis-monitoring-vault-secret-auth
  namespace: icis-monitoring
spec:
  method: kubernetes
  mount: cha/eks-a
  kubernetes:
    role: kv-icis-monitoring-read
    serviceAccount: icis-monitoring

---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: grafana-db-secret
  namespace: icis-monitoring
spec:
  type: kv-v2
  mount: kv/cha/k8s
  path: icis-monitoring/grafana/database
  destination:
    name: grafana-db-secret
    create: true
  refreshAfter: 300s
  vaultAuthRef: icis-monitoring-vault-secret-auth

---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: grafana-sso-auth-secret
  namespace: icis-monitoring
spec:
  type: kv-v2
  mount: kv/cha/k8s
  path: icis-monitoring/grafana/azure-sso 
  destination:
    name: grafana-sso-auth-secret
    create: true
  refreshAfter: 300s
  vaultAuthRef: icis-monitoring-vault-secret-auth


